# Репозиторий проекта WTF - Work To Find
Проект представляет собой FastAPI backend-приложение и frontend-часть на react

## Запуск
- Backend: `main.py:app`
- Frontend: _будет описан позже_

# Функции backend-API

## Авторизация
1. `/auth/register`:
Функция принимает json-объект авторизации в формате `{username: "username", password: "password"}` и возвращает результат выполнения запроса на регистрацию
2. `/auth/login`:
Функция принимает login и password, сопоставляет их с данными в базе, и при успешном подтверждении возвращает JWT-токен авторизации
3. `/auth/logout`:
Функция принимает токен, отправленный в запросе, и ничего не возвращает, выполняя при этом удаление соответствующего токена из базы, что делает его не актуальным
4. `/auth/delete_user`:
Функция принимает токен в запросе, а так же пароль, и удаляет аккаунт пользователя при успешной проверке пароля

> Далее пометка `+ Auth` будет означать, что функция требует передачи токена в заголовок запроса:
```
curl -X 'POST' \
  'http://127.0.0.1:8000/auth/logout' \
  -H 'accept: application/json' \
  -H 'Authorization: Bearer {TOKEN}'
```
> Где `{TOKEN}` - JWT-токен авторизации

## Профиль
1. `GET` `/profiles/me` `+ Auth`: json-объект пользователя
2. `POST` `/profiles/me/add_icon` `+ Auth`:
Файл-картинка > json-объект профиля после установление новой иконки
3. `PATCH` `/profiles/me/update_icon` `+ Auth`:
Файл-картинка > json-объект профиля после установление новой иконки
4. `DELETE` `/profiles/me/delete_icon` `+ Auth`:
Ничего > json-объект профиля после удаления иконки
5. `PATCH` `/profiles/me/update` `+ Auth`:
Функция заполнения или внесения любого изменения в данные профиля. Получает:
   - full_name - Строка с именем и фамилией через пробел 
   - app_id - Строка с публичным id пользователя
   - do_search - Логическое значение. True - показывать в поиске, False - нет
   - description - Строка с описанием
   - roles - Строка со всеми ролями через `,_` _(запятую пробел)_
   - stack - Строка стека
    > Если данные не следует изменять, то ничего не нужно передавать
6. `GET` `/profiles/{app_id}`:
`App_id` _(публичный id)_ > json-объект профиля пользователя

## Команды
1. `POST` `/teams/create` `+ Auth`: Принимает `title` и `app_id` > объект созданной команды или ошибку
2. `GET` `/teams/my_own` `+ Auth`: > Массив команд, где запрашивающий - владелец
3. `DELETE` `/teams/my_own/{team_id}/delete` `+ Auth`: `team_id` > Успех или ошибка
4. `PATCH` `/teams/my_own/{team_id}/delete_member` `+ Auth`: `team_id`, `member_id` > Успех или ошибка
5. `GET` `/teams/my` `+ Auth`: > Массив команд, где запрашивающий - участник (владелец тоже считается участником)
6. `GET` `/teams/{team_id}`: `team_id` > Объект команда с заданным `team_id`
7. `PATCH` `/teams/{team_id}/patch` `+ Auth`: Функция заполнения или внесения любого изменения в данные профиля команды. Получает:
   - team_id - Публичный ID команды - строка с @
   - title - Название - строка
   - description - Описание - строка
   - missing_roles - Недостающие роли - строка со всеми ролями через `,_` _(запятую пробел)_
   > Если данные не следует изменять, то ничего не нужно передавать

## Чаты
1. `POST` `/chats/create` `+ Auth`: `addresser` - _(строка `app_id` пользователя)_ > Объект чата
2. `GET` `/chats/my` `+ Auth`: > Массив чатов, где запрашивающий - участник (в т.ч. групп)
3. `GET` `/chats/{chat_id}` `+ Auth`: `chat_id` > Объект чата по `chat_id`, если пользователь - участник
4. `GET` `/chats/{chat_id}/get_last_messages`: 
   - `chat_id`
   - `page` _(опционально, по умолчанию - 1)_ - номер двадцатки сообщений для получения. Используется для порционального получения всех сообщений чата
   - `single`_(опционально, по умолчанию - False)_ - получить только последнее сообщение
5. `WebSocket` `ws://` `/ws/{chat_id}?token={token}` - Отвечает за установление связи по WebSocket
> Примечательно(!), что `token` в WebSocket передаётся в виде параметра, а не через заголовок

## Приглашения
1. `GET` `/invites/my` `+ Auth`: > Массив объектов приглашений для пользователя
2. `POST` `/invites/create` `+ Auth`: `chat_id`, `team_id` > Массив из двух элементов: объект сообщения и объект приглашения
3. `POST` `/invites/{invite_id}/status` `+ Auth`: `invite_id`, `status` - True или False (принять или отклонить) > объект приглашения
4. `DELETE` `/invites/{invite_id}/cancel` `+ Auth`: `invite_id` > Удаляет приглашение, если оно ещё не было принято или отклонено

## Поиск
1. `GET` `/search/profiles`: `roles` - роли для поиска пользователей, через `,_` _(запятую пробел)_ > Массив объектов всех подходящих пользователей
2. `GET` `/search/teams`: `roles` - роли для поиска команд, через `,_` _(запятую пробел)_ > Массив объектов всех подходящих команд

## Календарь
1. `GET` `/calendar/{month}`: `month` _(номер месяца)_ > Массив событий за конкретный месяц года